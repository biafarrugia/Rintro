---
title: "R4journalists: stock prices, vis and interactive page"
output: html_notebook
---

# Fetching stock data (`quantmod`), visualising it (`dygraphs`) and making it interactive with `htmlwidgets` (R for journalists chapter 3)

This code is based on [chapter 3](http://www.machlis.com/R4Journalists/download-and-graph-a-citys-median-income.html) in Sharon Machlis's book R for Journalists.

First we install some packages.

```{r install packages}
#These aren't installed so have to be installed
install.packages(c("quantmod", "dygraphs"))
#This one is, so just needs to be activated
library(htmlwidgets)
#And we activate the others now too
library(quantmod)
library(dygraphs)
```


## Fetching stock information

The `getSymbols` function in the `quantmod` package needs a stock symbol (e.g. 'GOOG' for Google stock), a source, and you can specify a date range with `from =` and `to =`; it will default to the current date if not specified. The `auto.assign = FALSE` argument just means it can assign the results to a variable.

The new variable is described as an 'xts object' in the Environment window. This means 'extensible time series', in other words time-related data. Google the term and you will find more resources [such as this one](http://rstudio-pubs-static.s3.amazonaws.com/288218_117e183e74964557a5da4fc5902fc671.html) if you want to know more.

```{r fetch stock prices and vis}
#Fetch the specified stock price(s) for the specified date range (until now)
google_stock_prices <- quantmod::getSymbols("GOOG", src = "yahoo", from = "2008-01-01",
                                  auto.assign = FALSE)
#Now visualise it
quantmod::chartSeries(google_stock_prices)
```

## Drawing an interactive chart

The chart above is drawn by `quantmod` but we can create an interactive version using the `dygraph()` function from the `dygraphs` package.

This takes the 'xts' object created above (containing the stock prices) - specifically a column within that (in this case closing prices) and a title defined by `main =`.

```{r draw interactive graph}
#Draw an interactive graph
dygraphs::dygraph(google_stock_prices[,c("GOOG.Close")], 
        main = "Google Stock Price Starting in 2008")
```

Once drawn you can hover your mouse and see different values. You can also click and drag over a part of the graph to 'zoom in' (double-click to zoom back out).

## Exporting as an interactive HTML/JavaScript webpage

We can export this as an interactive HTML page by storing the graph (when it is drawn) in a variable, then using that variable in a `saveWidget()` function (from the `htmlwidets` package)


```{r store & draw graph}
#Draw the graph but this time store it in a variable
stockgraph <- dygraphs::dygraph(google_stock_prices[,c("GOOG.Close")], 
        main = "Google Stock Price Starting in 2008")
#Save that graph (variable) as a html file
htmlwidgets::saveWidget(stockgraph, file="stockgraph.html")
```

This will be in the same folder as the other files for this project. Open it in a browser to interact with it in the same way. If you view the source HTML you will see a large amount of JavaScript code which generates the interactivity. 

Note that there are alternatives to using the closing price. To see what options you have, use the base R `names()` function:

```{r show names in object}
names(google_stock_prices)
```
